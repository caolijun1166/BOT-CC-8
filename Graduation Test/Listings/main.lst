C51 COMPILER V9.56.0.0   MAIN                                                              08/24/2017 09:29:14 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\DevelopmentTools\Keil 5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          //****************************************BOT-CC Graduation Desgin****************************************
             -*******//
   2          
   3          //*******************************************²ÜÀñ¿¡ 14111800420*******************************************
             -*******//
   4          #include <stc12.h>
   5          #include <stdio.h>
   6          #include "delay.h"
   7          //**********************************ÉùÃ÷Çø**********************************//
   8          typedef unsigned char  U8;       /* defined for unsigned 8-bits integer variable    ÎÞ·ûºÅ8Î»ÕûÐÍ±äÁ¿  */
   9          #define uchar unsigned char
  10          #define uint unsigned int
  11          #define param 500
  12          //------------------------------------------------------------------------------
  13          void InitUART(void);//´®¿Ú³õÊ¼»¯º¯Êý
  14          void InitESP8266(void);//ESP8266³õÊ¼»¯º¯Êý
  15          void ESP8266SEND(char *a);//ESP8266·¢ËÍº¯Êý
  16          void send(char *a,char num);
  17          void RH();
  18          void COM();
  19          //void Delay_10us();
  20          //void Delay18ms();
  21          //void delay(unsigned int a);
  22          //void delay_ms(unsigned int t);
  23          //------------------------------------------------------------------------------
  24          sbit dht11  = P2^1;
  25          sbit LED = P2^2;
  26          //int count = 0;
  27          U8  U8FLAG,k;
  28          U8  U8comdata;
  29          U8  U8temp;
  30          U8  U8T_data_H,U8T_data_L,U8RH_data_H,U8RH_data_L,U8checkdata;
  31          U8  U8T_data_H_temp,U8T_data_L_temp,U8RH_data_H_temp,U8RH_data_L_temp,U8checkdata_temp;
  32          unsigned char temph[8]={0xee,0xcc,0x02,0x00,0x00,0x00,0x00,0xff};
  33          unsigned char UART_buff;  
  34          //**************************************************************************//
  35          
  36          //**********************************Ö÷º¯Êý**********************************//
  37          void main()
  38          {
  39   1        InitUART();   //´®¿Ú³õÊ¼»¯
  40   1        InitESP8266();//ESP8266³õÊ¼»¯º¯Êý
  41   1        while(1)
  42   1        {
  43   2          RH(); 
  44   2          ESP8266SEND(temph);
  45   2          delay(1000); //ÑÓÊ±Ô¼1s
  46   2        }
  47   1      }
  48          
  49          void ser_int (void) interrupt 4   
  50          {  
  51   1          if(RI == 1){  
  52   2            RI = 0;
C51 COMPILER V9.56.0.0   MAIN                                                              08/24/2017 09:29:14 PAGE 2   

  53   2            UART_buff = SBUF;  
  54   2            if(UART_buff == '1')  LED = 1;  
  55   2            if(UART_buff == '0')  LED = 0;  
  56   2          }
  57   1      } 
  58          
  59          
  60          //**********************************´®¿Ú³õÊ¼»¯º¯Êý**********************************//
  61          void InitUART(void)//´®¿Ú³õÊ¼»¯º¯Êý
  62          {  
  63   1         PCON &= 0x7f;  //²¨ÌØÂÊ²»±¶ËÙ
  64   1         SCON = 0x50;  //8Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ
  65   1         BRT = 0xFD;      //Éè¶¨¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷ÖØ×°Öµ
  66   1         AUXR |= 0x04;  //¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷Ê±ÖÓÎªFosc,¼´1T
  67   1         AUXR |= 0x01;  //´®¿Ú1Ñ¡Ôñ¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷Îª²¨ÌØÂÊ·¢ÉúÆ÷
  68   1         AUXR |= 0x10;  //Æô¶¯¶ÀÁ¢²¨ÌØÂÊ·¢ÉúÆ÷
  69   1         EA = 1;
  70   1         TR1 = 1;       //Æô¶¯¶¨Ê±Æ÷
  71   1         TI = 1;        //´ò¿ª¶¨Ê±Æ÷ÖÐ¶Ï
  72   1      }
  73          
  74          //**********************************ESP8266³õÊ¼»¯º¯Êý**********************************//
  75          void InitESP8266(void){
  76   1        delay_ms(50000);
  77   1        //½«WIFIÄ£¿éÉèÖÃÎªSTAÄ£Ê½
  78   1        printf("AT+CWMODE=1\r\n");
  79   1        delay_ms(param);
  80   1        //½«WIFIÄ£¿éÉèÖÃÎªµ¥Á´½ÓÄ£Ê½
  81   1        printf("AT+CIPMUX=0\r\n");
  82   1        delay_ms(param);
  83   1        //²é¿´STAÄ£Ê½ÊÇ·ñÉèÖÃ³É¹¦£¨µ÷ÊÔÓÃ£©
  84   1        printf("AT+CWMODE?\r\n");
  85   1        delay_ms(param);
  86   1        //²é¿´µ¥Á´½ÓÄ£Ê½ÊÇ·ñÉèÖÃ³É¹¦£¨µ÷ÊÔÓÃ£©
  87   1        printf("AT+CIPMUX?\r\n");
  88   1        delay_ms(param);
  89   1        //½«WIFIÄ£¿éÉèÖÃÎªÍ¸´«Ä£Ê½
  90   1        printf("AT+CIPMODE=1\r\n");
  91   1        delay_ms(param);
  92   1        //²é¿´Í¸´«Ä£Ê½ÊÇ·ñÉèÖÃ³É¹¦£¨µ÷ÊÔÓÃ£©
  93   1        printf("AT+CIPMODE?\r\n");
  94   1        delay_ms(param);
  95   1        //·µ»Øµ±Ç°Ñ¡ÔñµÄAPµÄÐÅÏ¢
  96   1        printf("AT+CWJAP?\r\n");
  97   1        delay_ms(param);
  98   1        //Á¬½Ó·þÎñÆ÷
  99   1        printf("AT+CIPSTART=\"TCP\",\"192.168.155.1\",8888\r\n");
 100   1        delay_ms(15000);
 101   1        //²é¿´Óë·þÎñÆ÷µÄÁ¬½Ó×´Ì¬£¨µ÷ÊÔÓÃ£©
 102   1        printf("AT+CIPSTATUS\r\n");
 103   1        delay_ms(2000);
 104   1        
 105   1      }
 106          
 107          //**********************************ESP8266·¢ËÍº¯Êý**********************************//
 108          void ESP8266SEND(char *a)
 109          {
 110   1        unsigned char i;
 111   1        //½«WIFIÄ£¿éÉèÖÃÎªCIPCENDÄ£Ê½£¬ÓÃÀ´·¢ËÍÊý¾Ý
 112   1        printf("AT+CIPSEND\r\n");
 113   1        delay_ms(param);
 114   1        //·¢ËÍÊý¾Ý
C51 COMPILER V9.56.0.0   MAIN                                                              08/24/2017 09:29:14 PAGE 3   

 115   1        for(i=0;i<8;i++){
 116   2          printf("%04X ",a[i]);
 117   2        }
 118   1        printf("\r\n");
 119   1        delay_ms(1000);
 120   1        //ÍË³öCIPSENDÄ£Ê½
 121   1        printf("+++");
 122   1        //ÖØÆôÄ£¿é£¬ÑéÖ¤CIPSENDÄ£Ê½ÊÇ·ñÍË³ö³É¹¦£¨µ÷ÊÔÓÃ£©
 123   1        //printf("AT+RST\r\n");
 124   1      }
 125          
 126          //**********************************ÎÂÊª¶È³õÊ¼»¯º¯Êý**********************************//
 127          void COM(void)
 128          {
 129   1           U8 i;
 130   1           for(i=0;i<8;i++)    
 131   1           {
 132   2             U8FLAG=2;
 133   2             while((!dht11)&&U8FLAG++);
 134   2               Delay_10us();
 135   2               Delay_10us();
 136   2               Delay_10us();
 137   2             U8temp=0;
 138   2              if(dht11)U8temp=1;
 139   2              U8FLAG=2;
 140   2           while((dht11)&&U8FLAG++);
 141   2            //³¬Ê±ÔòÌø³öforÑ­»·     
 142   2             if(U8FLAG==1)break;
 143   2            //ÅÐ¶ÏÊý¾ÝÎ»ÊÇ0»¹ÊÇ1   
 144   2             
 145   2          // Èç¹û¸ßµçÆ½¸ß¹ýÔ¤¶¨0¸ßµçÆ½ÖµÔòÊý¾ÝÎ»Îª 1 
 146   2             
 147   2             U8comdata<<=1;
 148   2               U8comdata|=U8temp;        //0
 149   2             }//rof    
 150   1      }
 151          
 152          //**********************************ÎÂÊª¶È¶ÁÈ¡×Ó³ÌÐò**********************************//
 153            //--------------------------------
 154            //----ÒÔÏÂ±äÁ¿¾ùÎªÈ«¾Ö±äÁ¿--------
 155            //----ÎÂ¶È¸ß8Î»== U8T_data_H------
 156            //----ÎÂ¶ÈµÍ8Î»== U8T_data_L------
 157            //----Êª¶È¸ß8Î»== U8RH_data_H-----
 158            //----Êª¶ÈµÍ8Î»== U8RH_data_L-----
 159            //----Ð£Ñé 8Î» == U8checkdata-----
 160            //----µ÷ÓÃÏà¹Ø×Ó³ÌÐòÈçÏÂ----------
 161            //---- Delay();, Delay_10us();,COM(); 
 162          //***********************************************************************************//
 163            void RH(void)
 164            {
 165   1          ES = 0;
 166   1          //Ö÷»úÀ­µÍ18ms 
 167   1             dht11=0;
 168   1           Delay18ms();
 169   1           dht11=1;
 170   1         //×ÜÏßÓÉÉÏÀ­µç×èÀ­¸ß Ö÷»úÑÓÊ±20us
 171   1           Delay_10us();
 172   1           Delay_10us();
 173   1         //Ö÷»úÉèÎªÊäÈë ÅÐ¶Ï´Ó»úÏìÓ¦ÐÅºÅ 
 174   1           dht11=1;
 175   1         //ÅÐ¶Ï´Ó»úÊÇ·ñÓÐµÍµçÆ½ÏìÓ¦ÐÅºÅ Èç²»ÏìÓ¦ÔòÌø³ö£¬ÏìÓ¦ÔòÏòÏÂÔËÐÐ    
 176   1           if(!dht11)    //T !    
C51 COMPILER V9.56.0.0   MAIN                                                              08/24/2017 09:29:14 PAGE 4   

 177   1           {
 178   2           U8FLAG=2;
 179   2         //ÅÐ¶Ï´Ó»úÊÇ·ñ·¢³ö 80us µÄµÍµçÆ½ÏìÓ¦ÐÅºÅÊÇ·ñ½áÊø  
 180   2           while((!dht11)&&U8FLAG++);
 181   2           U8FLAG=2;
 182   2         //ÅÐ¶Ï´Ó»úÊÇ·ñ·¢³ö 80us µÄ¸ßµçÆ½£¬Èç·¢³öÔò½øÈëÊý¾Ý½ÓÊÕ×´Ì¬
 183   2           while((dht11)&&U8FLAG++);
 184   2         //Êý¾Ý½ÓÊÕ×´Ì¬    
 185   2           COM();
 186   2           U8RH_data_H_temp=U8comdata;
 187   2           COM();
 188   2           U8RH_data_L_temp=U8comdata;
 189   2           COM();
 190   2           U8T_data_H_temp=U8comdata;
 191   2           COM();
 192   2           U8T_data_L_temp=U8comdata;
 193   2           COM();
 194   2           U8checkdata_temp=U8comdata;
 195   2           dht11=1;
 196   2         //Êý¾ÝÐ£Ñé
 197   2           U8temp=(U8T_data_H_temp+U8T_data_L_temp+U8RH_data_H_temp+U8RH_data_L_temp);
 198   2           if(U8temp==U8checkdata_temp)
 199   2           {
 200   3            temph[3]=U8RH_data_H_temp;
 201   3            temph[4]=U8RH_data_L_temp;
 202   3            temph[5]=U8T_data_H_temp;
 203   3            temph[6]=U8T_data_L_temp;
 204   3           }
 205   2           }
 206   1           ES = 1;        //´ò¿ª´®¿ÚÖÐ¶Ï£¬Ä¿Ç°±ØÐëÔÚÕâ´ò¿ª´®¿ÚÖÐ¶Ï£¬Èç¹ûÔÙESP8266³õÊ¼»¯Ö®Ç°´ò¿ª£¬ÄÇÃ´ATÖ¸Áî·¢ËÍºóÍ
             -¨¹ý´®¿Ú·µ»ØµÄ·µ»ØÖµ»á´¥·¢ÖÐ¶Ï£¬µ¼ÖÂÒ»Ð©ÎÊÌâ
 207   1        }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    498    ----
   CONSTANT SIZE    =    177    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
